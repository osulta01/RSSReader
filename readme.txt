More powerful version here: https://gist.github.com/1178136